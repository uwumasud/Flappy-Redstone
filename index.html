<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>Flying Stoney</title>

  <!-- Optional: use your gameover icon -->
  <link rel="icon" href="assets/sprites/gameover.png" />

  <!-- Preload a few heavy images so splash appears instantly -->
  <link rel="preload" as="image" href="assets/sprites/background-day.png" />
  <link rel="preload" as="image" href="assets/sprites/base.png" />
  <link rel="preload" as="image" href="assets/sprites/redbird-midflap.png" />

  <!-- Your existing game styles -->
  <link rel="stylesheet" href="./style.css" />

  <!-- Minimal styles for splash + leaderboard button -->
  <style>
    /* Make the wrapper the positioning context for floating controls */
    #app { position: relative; max-width: 320px; margin: 0 auto; }

    /* Fullscreen (within #app) canvas */
    #game { display:block; width:100%; height:auto; background:#141a22; }

    /* Splash overlay */
    .splash{
      position:absolute; inset:0; display:grid; place-items:center;
      background:#0d1117; transition:opacity .18s ease; z-index:4;
    }
    .splash .bg{ position:absolute; inset:0; overflow:hidden; }
    .splash .bg-img{ position:absolute; inset:auto 0 112px 0; width:100%; object-fit:cover; }
    .splash .base-img{ position:absolute; bottom:0; left:0; width:100%; }
    .splash .card{
      position:relative; z-index:1; width:85%; max-width:260px;
      background:#0d1117e6; border:1px solid #2a3340; border-radius:14px;
      padding:12px; color:#e6edf3; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,.45);
    }
    .splash .title{ display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:8px; }
    .splash .logo{ width:36px; height:auto; image-rendering:pixelated; }
    .splash .card a{ color:#e6edf3; text-decoration:none; font-weight:700; }
    .splash .cta{
      margin-top:8px; padding:8px 12px; border-radius:10px; border:1px solid #2a3340;
      background:#161b22; color:#e6edf3; cursor:pointer;
    }
    .splash .cta:hover{ background:#1b2230; }

    /* Floating Leaderboard button (top-right over canvas) */
    #lbBtn{
      position:absolute; right:8px; top:8px; z-index:5;
      width:40px; height:40px; border-radius:20px;
      border:1px solid #2a3340; background:#0d1117; color:#e6edf3;
      display:flex; align-items:center; justify-content:center;
      font-size:18px; cursor:pointer; opacity:.9;
    }
    #lbBtn:hover{ opacity:1; }
  </style>
</head>
<body>
  <div id="app">
    <!-- Game canvas -->
    <canvas id="game" width="288" height="512" aria-label="Flying Stoney"></canvas>

    <!-- Leaderboard FAB (game.js will attach handlers) -->
    <button id="lbBtn" aria-label="Leaderboard">üèÜ</button>

    <!-- One-button splash -->
    <div id="splash" class="splash" aria-hidden="false">
      <div class="bg">
        <img class="bg-img"   src="assets/sprites/background-day.png" alt="" />
        <img class="base-img" src="assets/sprites/base.png" alt="" />
      </div>
      <div class="card">
        <div class="title">
          <img src="assets/sprites/redbird-midflap.png" alt="" class="logo" />
          <a id="gameName" href="https://t.me/your_username" target="_blank" rel="noopener">Flying Stoney</a>
        </div>
        <p id="subtitle">Tap Play to begin</p>
        <button id="playBtn" class="cta">‚ñ∂ Play</button>
      </div>
    </div>
  </div>

  <!-- Your game code -->
  <script type="module" src="./src/game.js"></script>
  <script>
    // Telegram expand (safe no-op elsewhere)
    if (window.Telegram?.WebApp) Telegram.WebApp.expand();

    // Splash wiring
    const splash   = document.getElementById('splash');
    const playBtn  = document.getElementById('playBtn');
    const subtitle = document.getElementById('subtitle');

    function hideSplash() {
      splash.style.opacity = '0';
      setTimeout(() => { splash.style.display = 'none'; }, 180);
    }
    function showSplash(text) {
      if (text) subtitle.textContent = text;
      splash.style.display = 'grid';
      void splash.offsetHeight; // reflow for fade-in
      splash.style.opacity = '1';
    }

    playBtn.addEventListener('click', () => {
      hideSplash();
      // Tell game.js to start (your loop listens for this)
      window.dispatchEvent(new Event('stoney:start'));
    });

    // Show splash again after game over (game.js dispatches this with score)
    window.addEventListener('stoney:gameover', (e) => {
      const score = e?.detail?.score ?? 0;
      showSplash(`Game Over ‚Äî Score: ${score}`);
    });
  </script>
</body>
</html>
